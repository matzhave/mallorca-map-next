# ğŸ—ï¸ Cursor AI Rules - Mallorca Map Monorepo

> **DIESE DATEI IST DEINE BIBEL - Alles was du wissen musst ist hier!**  
> Konsolidiert aus: README.md, QUICKSTART.md, MONOREPO_GUIDE.md, ARCHITECTURE.md, DEVELOPMENT_PRINCIPLES.md, DEPLOYMENT.md

---

# ğŸ”´ SEKTION 1: KRITISCHE REGELN (ÃœBERGEORDNET!)

## âš ï¸ THE GOLDEN RULES (Nichts ist wichtiger!)

### 1. **NIEMALS git push selbst machen!**
- âŒ Claude darf NICHT: `git push origin main`
- âœ… NUR der User (Matthias) darf pushen!
- ğŸ”´ **GRUND:** Deployment geht SOFORT LIVE nach Push via GitHub Actions!
- **Workflow:** Claude committet lokal â†’ "Bereit zum Push!" â†’ User pusht â†’ Auto-Deploy

### 2. **KEINE Kompromisse, Pfusch-LÃ¶sungen, Workarounds**
- âŒ Quick Fixes die spÃ¤ter Probleme erzeugen
- âŒ "Funktioniert erstmal" ohne langfristig zu denken
- âœ… IMMER die professionelle, skalierbare LÃ¶sung
- âœ… IMMER State-of-the-Art Best Practices
- **Langfristig denken:** Dieses Projekt lÃ¤uft 10+ Jahre!

### 3. **Root Cause lÃ¶sen, nicht umgehen**
- Bei Problemen: Analysieren â†’ Recherchieren â†’ Richtig implementieren â†’ Dokumentieren
- Beispiel: PostGIS `geography` Type nicht gefunden?
  - âŒ FALSCH: Einfach `latitude/longitude` Spalten nutzen
  - âœ… RICHTIG: PostGIS korrekt konfigurieren (extensions, search_path, etc.)

### 4. **Shared vs App-Spezifisch - STRIKT TRENNEN!**
- Dies ist das WICHTIGSTE Konzept des Monorepo!
- Siehe **SEKTION 3: MONOREPO STRUKTUR**

### 5. **TypeScript Strict Mode - IMMER!**
- âŒ NIEMALS `any` Type verwenden
- âœ… IMMER fully typed (Props, Returns, Variables)
- Strict Mode ist aktiviert in `tsconfig.json`

---

# ğŸ“ SEKTION 2: PROJEKT-KONTEXT (Wissen fÃ¼r jeden Befehl!)

## ğŸ¯ Projekt-Details

**Name:** Mallorca Map Next  
**Typ:** Full-Stack Monorepo mit Web + Mobile  
**Package Manager:** Bun 1.1.40+  
**Node Version:** >=20.0.0  
**Build Tool:** Turborepo 2.3.3+  
**Status:** ğŸš§ Aktive Entwicklung  

---

## ğŸ“Š Monorepo-Struktur (JEDERZEIT DENKEN!)

```
mallorca-map-next/                    # ROOT WORKSPACE
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                         # ğŸŒ Next.js 15 (SSR/ISR)
â”‚   â”‚   â”œâ”€â”€ src/app/[lang]/         # App Router mit Dynamic Segments (de/en/es)
â”‚   â”‚   â”œâ”€â”€ src/components/         # React Components (shadcn/ui)
â”‚   â”‚   â”œâ”€â”€ src/lib/utils.ts        # Utilities
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts      # Tailwind Setup
â”‚   â”‚   â””â”€â”€ .env.local              # Secrets (in .gitignore, SERVER ONLY!)
â”‚   â”‚
â”‚   â””â”€â”€ mobile/                      # ğŸ“± React Native Expo
â”‚       â”œâ”€â”€ app/                     # Expo Router (Native Stack)
â”‚       â”œâ”€â”€ components/              # Native Components
â”‚       â”œâ”€â”€ tailwind.config.js       # NativeWind Config
â”‚       â””â”€â”€ .env.local               # Secrets (in .gitignore, SERVER ONLY!)
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/                      # ğŸ“¦ **Shared Utilities (GEHIRN!)**
â”‚   â”‚   â”œâ”€â”€ src/types.ts            # Types & Interfaces (alle!)
â”‚   â”‚   â”œâ”€â”€ src/utils/              # Pure Functions & Logik
â”‚   â”‚   â”œâ”€â”€ src/queries/            # Supabase Services
â”‚   â”‚   â”œâ”€â”€ src/i18n/               # Translations (de.json, en.json, es.json)
â”‚   â”‚   â”œâ”€â”€ src/constants.ts        # Constants & Enums
â”‚   â”‚   â””â”€â”€ package.json            # "@repo/shared"
â”‚   â”‚
â”‚   â”œâ”€â”€ supabase/                    # ğŸ—„ï¸ Supabase Client
â”‚   â”‚   â”œâ”€â”€ src/client.ts           # Supabase Initialization
â”‚   â”‚   â”œâ”€â”€ src/types.ts            # Generated Types
â”‚   â”‚   â””â”€â”€ package.json            # "@repo/supabase"
â”‚   â”‚
â”‚   â””â”€â”€ typescript-config/           # âš™ï¸ Shared TS Configs
â”‚       â”œâ”€â”€ base.json               # Base Config
â”‚       â”œâ”€â”€ nextjs.json             # For Web
â”‚       â”œâ”€â”€ react-native.json       # For Mobile
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ turbo.json                       # Turborepo Pipeline
â”œâ”€â”€ .cursorrules                     # Diese Datei! ğŸ“–
â””â”€â”€ package.json                     # Root Config

```

---

## ğŸ”§ Tech Stack

| Bereich | Technologie | Version |
|---------|-------------|---------|
| **Monorepo** | Turborepo | 2.3.3+ |
| **Package Manager** | Bun | 1.1.40+ |
| **Web Frontend** | Next.js 15 | App Router |
| **Web Styling** | Tailwind CSS + shadcn/ui | 3.4 |
| **Mobile** | React Native + Expo | Latest |
| **Mobile Styling** | NativeWind | Tailwind fÃ¼r RN |
| **i18n** | next-intl + Custom JSON | DE/EN/ES |
| **Backend** | Supabase (PostgreSQL) | REST + Realtime |
| **Icons** | lucide-react / lucide-react-native | Latest |

---

## ğŸ¨ Design System

### Farben
```css
--primary: #14B8C4      /* Teal/TÃ¼rkis */
--secondary: #F4EDE4    /* Beige/Crema */
--accent: #FF6B6B       /* Coral/Rot */
```

### Typography
- **Font:** Inter (Variable Font)
- **Scale:** Fluid Typography (clamp)
- **Line Height:** 1.5 (Body), 1.2 (Headings)

### Spacing
- **Base:** 4px (0.25rem)
- **Container:** max-w-7xl (1280px)
- **Grid:** 12 Columns

### Modern UI Practices
- âœ… Dark Mode Support (konfiguriert: `darkMode: ['class']`)
- âœ… Responsive First (Mobile â†’ Tablet â†’ Desktop)
- âœ… Accessible (WCAG 2.1 AA)
- âœ… shadcn/ui Components (Radix-based)
- âœ… Tailwind Utility Classes

---

## ğŸ“– Sprachen & i18n

**UnterstÃ¼tzte Sprachen:** Deutsch (de), English (en), EspaÃ±ol (es)

**URL-Struktur:**
- `/de/...` â†’ Deutsch
- `/en/...` â†’ English
- `/es/...` â†’ EspaÃ±ol

**i18n Dateien:**
- `packages/shared/src/i18n/de.json` - Deutsch
- `packages/shared/src/i18n/en.json` - English
- `packages/shared/src/i18n/es.json` - EspaÃ±ol

**Format:** `{ "section.key": "Wert" }`

**âš ï¸ WICHTIG:** Neue Keys MÃœSSEN in **ALLE 3 Dateien** hinzugefÃ¼gt werden!

---

# ğŸš€ SEKTION 3: MONOREPO-ARCHITEKTUR (KERNKONZEPT!)

## Mental Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    @repo/shared = DAS GEHIRN             â”‚
â”‚    (Logik, Types, Daten, i18n)          â”‚
â”‚                                         â”‚
â”‚  â€¢ Types & Interfaces (alle!)           â”‚
â”‚  â€¢ Business Logic (Berechnungen)        â”‚
â”‚  â€¢ Supabase Queries (Services)          â”‚
â”‚  â€¢ Validierungen                        â”‚
â”‚  â€¢ Formatierungsfunktionen              â”‚
â”‚  â€¢ i18n Strings (DE/EN/ES!)             â”‚
â”‚  â€¢ Constants & Enums                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†™                     â†˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ apps/web     â”‚      â”‚apps/mobile   â”‚
    â”‚ DIE AUGEN    â”‚      â”‚  DIE AUGEN   â”‚
    â”‚              â”‚      â”‚              â”‚
    â”‚ â€¢ React Cmp  â”‚      â”‚â€¢ RN Cmp      â”‚
    â”‚ â€¢ shadcn/ui  â”‚      â”‚â€¢ NativeWind  â”‚
    â”‚ â€¢ Tailwind   â”‚      â”‚â€¢ Tailwind    â”‚
    â”‚ â€¢ Pages      â”‚      â”‚â€¢ Screens     â”‚
    â”‚ â€¢ Routing    â”‚      â”‚â€¢ Navigator   â”‚
    â”‚ â€¢ HTML/CSS   â”‚      â”‚â€¢ Native View â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Kernprinzip:** Teile die Logik zwischen Apps, halte die UI platform-spezifisch!

---

## âœ… SHARED PACKAGE (@repo/shared) - WAS GEHÃ–RT REIN?

### 1. **Types & Interfaces (IMMER!)**

```typescript
// packages/shared/src/types.ts
export interface User {
  id: string;
  name: string;
  email: string;
  avatar_url?: string;
}

export interface Activity {
  id: string;
  title: string;
  category: 'hiking' | 'beach' | 'culture';
  location: { lat: number; lng: number };
  difficulty: 'easy' | 'medium' | 'hard';
  duration_minutes: number;
  rating: number;
  image_url: string;
}

export type ApiResponse<T> = {
  data?: T;
  error?: string;
  timestamp: string;
};
```

**âœ… Grund:** Beide Apps nutzen die gleichen Datentypen von der Datenbank.

### 2. **GeschÃ¤ftslogik & Berechnungen**

```typescript
// packages/shared/src/utils/math.ts
export function calculateDistance(
  lat1: number, lng1: number,
  lat2: number, lng2: number
): number {
  const R = 6371;
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLng = ((lng2 - lng1) * Math.PI) / 180;
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos((lat1 * Math.PI) / 180) *
    Math.cos((lat2 * Math.PI) / 180) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2);
  return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
}

// packages/shared/src/utils/format.ts
export function formatDuration(minutes: number): string {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  if (hours === 0) return `${mins}min`;
  if (mins === 0) return `${hours}h`;
  return `${hours}h ${mins}min`;
}

export function getDifficultyColor(difficulty: string): {bg: string; text: string} {
  switch (difficulty) {
    case 'easy': return {bg: 'bg-green-100', text: 'text-green-800'};
    case 'medium': return {bg: 'bg-yellow-100', text: 'text-yellow-800'};
    case 'hard': return {bg: 'bg-red-100', text: 'text-red-800'};
    default: return {bg: 'bg-gray-100', text: 'text-gray-800'};
  }
}
```

**âœ… Grund:** Diese Logik ist in Web UND Mobile identisch. Warum zweimal schreiben?

### 3. **Supabase Queries & Services**

```typescript
// packages/shared/src/queries/activities.ts
import { supabase } from '@repo/supabase';
import type { Activity } from '../types';

export async function getActivityById(id: string): Promise<Activity | null> {
  const { data, error } = await supabase
    .from('activities')
    .select('*')
    .eq('id', id)
    .single();
  
  if (error) return null;
  return data as Activity;
}

export async function getActivitiesByCategory(category: string): Promise<Activity[]> {
  const { data, error } = await supabase
    .from('activities')
    .select('*')
    .eq('category', category)
    .order('rating', {ascending: false});
  
  return (data as Activity[]) || [];
}

export function subscribeToActivityChanges(callback: (activity: Activity) => void) {
  return supabase
    .on('postgres_changes', 
      {event: 'INSERT', schema: 'public', table: 'activities'},
      (payload) => callback(payload.new as Activity)
    )
    .subscribe();
}
```

**âœ… Grund:** DB-Queries sind nicht UI-spezifisch. Beide Apps fragen die gleichen Daten ab.

### 4. **Internationalisierung (i18n)**

```json
{
  "activity.title": "AktivitÃ¤t",
  "activity.difficulty": "Schwierigkeit",
  "activity.difficulty.easy": "Leicht",
  "activity.difficulty.medium": "Mittel",
  "activity.difficulty.hard": "Schwer",
  "category.hiking": "Wanderung",
  "category.beach": "Strand",
  "category.culture": "Kultur"
}
```

**âš ï¸ KRITISCH:** Alle Keys in **ALLE 3 Dateien!** (de.json, en.json, es.json)

### 5. **Constants & Enums**

```typescript
// packages/shared/src/constants.ts
export const ACTIVITY_CATEGORIES = ['hiking', 'beach', 'culture'] as const;
export const DIFFICULTY_LEVELS = ['easy', 'medium', 'hard'] as const;
export const SUPPORTED_LOCALES = ['de', 'en', 'es'] as const;

export const APP_CONFIG = {
  MAX_TITLE_LENGTH: 100,
  MAX_DESCRIPTION_LENGTH: 1000,
  DEFAULT_MAP_ZOOM: 12,
  DEFAULT_LOCATION: { lat: 39.5696, lng: 2.6502 },
} as const;
```

**âœ… Grund:** Diese Werte sind Ã¼berall gleich.

---

## âŒ APP-SPEZIFISCH - WAS GEHÃ–RT NICHT IN SHARED?

### âŒ 1. UI-Komponenten (NIEMALS!)

```typescript
// âŒ FALSCH - Bitte NICHT in @repo/shared!
// packages/shared/src/components/Button.tsx
export function Button({ children }) {
  return <button>{children}</button>; // âŒ HTML - Web only!
}
```

**âœ… RICHTIG - Separate Komponenten pro App:**

```typescript
// apps/web/src/components/Button.tsx (React)
import { Button as UiButton } from '@/components/ui/button';
export function Button({ children, onClick }) {
  return <UiButton onClick={onClick}>{children}</UiButton>;
}

// apps/mobile/components/Button.tsx (React Native)
import { TouchableOpacity, Text } from 'react-native';
export function Button({ children, onPress }) {
  return (
    <TouchableOpacity className="bg-primary px-4 py-2 rounded" onPress={onPress}>
      <Text className="text-white font-bold">{children}</Text>
    </TouchableOpacity>
  );
}
```

**Grund:** Web nutzt HTML `<button>`, Mobile nutzt `<TouchableOpacity>`. Nicht kompatibel!

### âŒ 2. Pages & Screens

```typescript
// âŒ FALSCH
// packages/shared/src/pages/Home.tsx - NEIN!

// âœ… RICHTIG
// apps/web/src/app/[lang]/page.tsx - Web Page
// apps/mobile/app/index.tsx - Mobile Screen
```

**Grund:** Routing ist vÃ¶llig unterschiedlich (Next.js File-based vs Expo Navigator).

### âŒ 3. Styling & CSS

```typescript
// âŒ FALSCH - Nicht in shared!
// packages/shared/src/components/Card.tsx
export function Card() {
  return <div className="p-4 rounded-lg">...</div>; // âŒ Tailwind in shared!
}

// âœ… RICHTIG - Separate in jeder App
// apps/web/src/components/Card.tsx
export function Card() {
  return <div className="bg-white p-4 rounded-lg shadow-md">...</div>;
}

// apps/mobile/components/Card.tsx
export function Card() {
  return <View className="bg-white p-4 rounded-lg">...</View>;
}
```

**Grund:** Web nutzt Tailwind CSS, Mobile nutzt NativeWind. Unterschiedliche Systeme!

### âŒ 4. Navigation & Routing

```typescript
// âŒ FALSCH
// packages/shared/src/router.ts - Bitte nicht!

// âœ… RICHTIG
// apps/web/src/app/[lang]/... - Next.js File-based Routing
// apps/mobile/app/_layout.tsx - Expo Navigator
```

**Grund:** Jede Platform hat ein eigenes Routing-System.

### âŒ 5. Platform-APIs

```typescript
// âŒ FALSCH - Platform APIs gehÃ¶ren nicht in shared!
export function getScreenSize() {
  return window.innerHeight; // âŒ window existiert nur im Browser!
}

// âœ… RICHTIG - Falls nÃ¶tig: Abstraktion + Implementierungen
export interface ScreenProvider {
  getHeight(): number;
}

// Web: apps/web/lib/screenProvider.ts
export class WebScreenProvider implements ScreenProvider {
  getHeight() { return window.innerHeight; }
}

// Mobile: apps/mobile/lib/screenProvider.ts
import { Dimensions } from 'react-native';
export class MobileScreenProvider implements ScreenProvider {
  getHeight() { return Dimensions.get('window').height; }
}
```

---

## ğŸ”„ Feature Development Workflow (SCHRITT FÃœR SCHRITT)

### Beispiel: Neue "Activity Detail" Feature

**1ï¸âƒ£ Types in Shared definieren**
```typescript
// packages/shared/src/types.ts
export interface Activity {
  id: string;
  title: string;
  description: string;
  category: 'hiking' | 'beach' | 'culture';
  difficulty: 'easy' | 'medium' | 'hard';
  duration_minutes: number;
  rating: number;
  image_url: string;
}
```

**2ï¸âƒ£ GeschÃ¤ftslogik in Shared**
```typescript
// packages/shared/src/utils/activityUtils.ts
export function formatDuration(minutes: number): string {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  if (hours === 0) return `${mins}min`;
  return `${hours}h ${mins}min`;
}
```

**3ï¸âƒ£ DB Queries in Shared**
```typescript
// packages/shared/src/queries/activities.ts
export async function getActivityById(id: string): Promise<Activity | null> {
  const { data, error } = await supabase
    .from('activities')
    .select('*')
    .eq('id', id)
    .single();
  return (data as Activity) || null;
}
```

**4ï¸âƒ£ i18n Keys in ALLE 3 Dateien!**
```json
// packages/shared/src/i18n/de.json
{
  "activity.title": "AktivitÃ¤t",
  "activity.difficulty": "Schwierigkeit",
  "activity.duration": "Dauer"
}

// packages/shared/src/i18n/en.json
{
  "activity.title": "Activity",
  "activity.difficulty": "Difficulty",
  "activity.duration": "Duration"
}

// packages/shared/src/i18n/es.json
{
  "activity.title": "Actividad",
  "activity.difficulty": "Dificultad",
  "activity.duration": "DuraciÃ³n"
}
```

**5ï¸âƒ£ Web Component (HTML/React/Tailwind)**
```typescript
// apps/web/src/components/ActivityDetail.tsx
import { Activity, formatDuration } from '@repo/shared';
import { useTranslations } from 'next-intl';
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';

export function ActivityDetail({ activity }: { activity: Activity }) {
  const t = useTranslations();
  
  return (
    <Card className="p-6">
      <img src={activity.image_url} alt={activity.title} className="w-full h-64 object-cover rounded-lg mb-4" />
      <h1 className="text-3xl font-bold mb-2">{activity.title}</h1>
      <p className="text-gray-600 mb-4">{activity.description}</p>
      <div className="flex gap-2 mb-4">
        <Badge>{t('activity.difficulty')}: {activity.difficulty}</Badge>
        <Badge>{t('activity.duration')}: {formatDuration(activity.duration_minutes)}</Badge>
      </div>
    </Card>
  );
}
```

**6ï¸âƒ£ Web Page**
```typescript
// apps/web/src/app/[lang]/activities/[id]/page.tsx
import { getActivityById } from '@repo/shared';
import { ActivityDetail } from '@/components/ActivityDetail';

export default async function ActivityPage({ params }: { params: { id: string } }) {
  const activity = await getActivityById(params.id);
  if (!activity) return <div>Not found</div>;
  return <ActivityDetail activity={activity} />;
}
```

**7ï¸âƒ£ Mobile Component (React Native)**
```typescript
// apps/mobile/components/ActivityDetail.tsx
import { Activity, formatDuration } from '@repo/shared';
import { useTranslations } from 'next-intl';
import { View, Text, Image, ScrollView } from 'react-native';
import { Badge } from '@/components/ui/badge';

export function ActivityDetail({ activity }: { activity: Activity }) {
  const t = useTranslations();
  
  return (
    <ScrollView className="flex-1 bg-white">
      <Image source={{uri: activity.image_url}} className="w-full h-64" />
      <View className="p-4">
        <Text className="text-2xl font-bold mb-2">{activity.title}</Text>
        <Text className="text-gray-600 mb-4">{activity.description}</Text>
        <View className="flex-row gap-2 mb-4">
          <Badge>{t('activity.difficulty')}: {activity.difficulty}</Badge>
          <Badge>{t('activity.duration')}: {formatDuration(activity.duration_minutes)}</Badge>
        </View>
      </View>
    </ScrollView>
  );
}
```

**8ï¸âƒ£ Mobile Screen**
```typescript
// apps/mobile/app/activity/[id].tsx
import { useLocalSearchParams } from 'expo-router';
import { useEffect, useState } from 'react';
import { getActivityById } from '@repo/shared';
import { ActivityDetail } from '@/components/ActivityDetail';

export default function ActivityScreen() {
  const { id } = useLocalSearchParams();
  const [activity, setActivity] = useState(null);

  useEffect(() => {
    if (id) getActivityById(id as string).then(setActivity);
  }, [id]);

  return activity ? <ActivityDetail activity={activity} /> : null;
}
```

**9ï¸âƒ£ Test!**
```bash
bun run type-check  # âœ… Keine TS Fehler?
bun run build       # âœ… Beide Apps bauen?
```

âœ… **Fertig!** Die neue Feature funktioniert auf Web & Mobile!

---

## ğŸ“Š Entscheidungsbaum (Wo gehÃ¶rt Code hin?)

```
START
  â†“
â”œâ”€ "Ist es UI/Komponenten/Styling?"
â”‚  â”œâ”€ JA â†’ app-spezifisch (apps/web ODER apps/mobile)
â”‚  â””â”€ NEIN â†“
â”‚
â”œâ”€ "Ist es eine Page oder Screen?"
â”‚  â”œâ”€ JA â†’ app-spezifisch
â”‚  â””â”€ NEIN â†“
â”‚
â”œâ”€ "Ist es Routing/Navigation?"
â”‚  â”œâ”€ JA â†’ app-spezifisch
â”‚  â””â”€ NEIN â†“
â”‚
â”œâ”€ "Nutzt es window, document, oder Mobile-APIs?"
â”‚  â”œâ”€ JA â†’ app-spezifisch (oder abstrahieren)
â”‚  â””â”€ NEIN â†“
â”‚
â”œâ”€ "Brauchen es BEIDE Apps?"
â”‚  â”œâ”€ JA â†’ @repo/shared âœ…
â”‚  â””â”€ NEIN â†’ app-spezifisch
â”‚
â””â”€ ERGEBNIS: @repo/shared! âœ…
```

---

# ğŸš€ SEKTION 4: COMMANDS & WORKFLOW

## ğŸ¯ Wichtige Commands (Turborepo)

```bash
bun install              # Dependencies installieren
bun run dev              # Alle Apps parallel starten (watch mode)
bun run build            # Production Build aller Apps
bun run lint             # ESLint Check
bun run type-check       # TypeScript Check
bun run clean            # Clean Build Artifacts
```

### Web App Specific
```bash
cd apps/web
bun run dev              # Next.js auf Port 3000
bun run build            # Production Build
bun run start            # Standalone Mode
```

### Mobile App Specific
```bash
cd apps/mobile
bun run dev              # Expo Dev Server
bun run build            # EAS Build
```

---

## ğŸ“‹ Feature Development Checkliste

âœ… **Vor dem Coden:**
- [ ] MONOREPO_GUIDE.md oder ARCHITECTURE.md gelesen?
- [ ] Wo gehÃ¶rt dieser Code hin?
- [ ] Braucht BEIDE Apps das?

âœ… **WÃ¤hrend der Entwicklung:**
- [ ] **Types** in `@repo/shared/src/types.ts`
- [ ] **Logik** in `@repo/shared/src/utils/`
- [ ] **DB Queries** in `@repo/shared/src/queries/`
- [ ] **i18n Keys** in **ALLE 3 JSON-Dateien!** (de, en, es)
- [ ] **Web Component** in `apps/web/src/components/`
- [ ] **Mobile Component** in `apps/mobile/components/`
- [ ] **Web Page** in `apps/web/src/app/[lang]/...`
- [ ] **Mobile Screen** in `apps/mobile/app/...`

âœ… **Vor dem Commit:**
- [ ] `bun run type-check` erfolgreich
- [ ] `bun run lint` erfolgreich
- [ ] `bun run build` erfolgreich (BEIDE Apps!)
- [ ] Keine `any` Types
- [ ] Keine UI Code in `@repo/shared`
- [ ] Alle Sprachen (DE/EN/ES) vorhanden

âœ… **Vor dem Push:**
- [ ] Git Commits sauber & aussagekrÃ¤ftig
- [ ] Code ist getestet
- [ ] Keine Secrets in Git!

---

## ğŸ“ Git Workflow

```bash
# Feature Branch erstellen
git checkout -b feature/my-feature

# Entwickeln, committen (Conventional Commits!)
git commit -m "feat(web): add activity detail page"
git commit -m "fix(shared): correct distance calculation"

# Tests & Checks
bun run type-check
bun run lint
bun run build

# Committen (ABER NICHT PUSHEN!)
git add .
git commit -m "feature description"

# âš ï¸ STOPP: NUR du pushst!
# Nachricht an Matthias: "Feature fertig, Code getestet, bereit zum Push!"
# Matthias: "Looks good, pushing..."
# â†’ GitHub Actions deployt automatisch!
```

---

# ğŸ” SEKTION 5: DEPLOYMENT & SICHERHEIT

## ğŸš€ Deployment Flow (KRITISCH!)

```
ğŸ“Œ SCHRITT 1ï¸âƒ£: Claude arbeitet
â”œâ”€ Code entwickeln
â”œâ”€ Lokal testen: bun run build âœ…
â”œâ”€ Lokal testen: bun run type-check âœ…
â”œâ”€ git add . && git commit -m "..."
â””â”€ "Code ist fertig & getestet! Bereit zum Push!"

ğŸ“Œ SCHRITT 2ï¸âƒ£: Matthias reviewt (optional)
â”œâ”€ Schaut Code an
â””â”€ "Looks good!" oder "Change X please"

ğŸ“Œ SCHRITT 3ï¸âƒ£: Matthias pusht (NUR ER!)
â”œâ”€ git push origin main
â””â”€ GitHub Actions triggert automatisch

ğŸ“Œ SCHRITT 4ï¸âƒ£: GitHub Actions (automatisch!)
â”œâ”€ Checkout Code
â”œâ”€ SSH Setup
â”œâ”€ Deploy zu Server:
â”‚  â”œâ”€ cd /app/mallorca-map-next
â”‚  â”œâ”€ git pull origin main
â”‚  â”œâ”€ bun install
â”‚  â”œâ”€ bun run build
â”‚  â”œâ”€ sudo systemctl restart mallorca-map-staging
â”‚  â””â”€ sudo systemctl reload nginx
â””â”€ Health Check

âœ… Live auf https://staging.mallorca-map.com
```

### âš ï¸ NIEMALS machen:
- âŒ `git push` selbst (nur Matthias!)
- âŒ SSH zum Deployen nutzen (GitHub Actions macht das!)
- âŒ `.env.local` committen (in .gitignore!)
- âŒ Secrets im Code hardcoden

---

## ğŸ” Environment Variables

### Lokal (Development)
```env
# apps/web/.env.local (in .gitignore)
NEXT_PUBLIC_SUPABASE_URL=https://...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
```

### Server (Staging/Production)
- `.env.local` ist **PERMANENT auf dem Server** unter: `/app/mallorca-map-next/apps/web/.env.local`
- Wird bei Deploy NICHT Ã¼berschrieben
- Ã„nderungen nur via SSH (Notfall)

---

## ğŸ“ Staging Environment

**URL:** https://staging.mallorca-map.com  
**Auth:** `staging / 9963` (HTTP Basic Auth)  
**Sicherheit:** 3-Layer Protection:
1. HTTP Basic Auth (Nginx)
2. X-Robots-Tag Header
3. robots.txt fÃ¼r Crawler

---

# ğŸ¨ SEKTION 6: CODE STYLE & KONVENTIONEN

## TypeScript (STRICT MODE!)

```typescript
// âœ… GUT - Full typed
interface UserProps {
  name: string;
  age: number;
  email?: string;
}

export function UserCard({ name, age, email }: UserProps): JSX.Element {
  return <div>{name}</div>;
}

// âŒ FALSCH - Any types
function getData(data: any) {  // âŒ No!
  return data.name;             // âŒ No!
}

// âŒ FALSCH - Implizite returns
export function BadFunction() {
  const x = getData();          // âŒ Kein Return type!
}
```

## Component Structure

```typescript
// Imports (gruppiert)
import { ReactNode } from 'react';
import { useTranslations } from 'next-intl';
import { Button } from '@/components/ui/button';
import { UserAvatar } from '@/components/UserAvatar';

// Types
interface UserHeaderProps {
  userName: string;
  avatarUrl?: string;
  children?: ReactNode;
}

// Component
export function UserHeader({ userName, avatarUrl, children }: UserHeaderProps) {
  const t = useTranslations();
  
  return (
    <header className="flex items-center gap-4 p-4">
      {avatarUrl && <UserAvatar src={avatarUrl} alt={userName} />}
      <div>
        <h1 className="text-lg font-bold">{userName}</h1>
        {children}
      </div>
    </header>
  );
}
```

## File Naming

| Type | Convention | Example |
|------|-----------|---------|
| Components | PascalCase | `Button.tsx`, `UserCard.tsx` |
| Utils | camelCase | `dateUtils.ts`, `stringHelpers.ts` |
| Types | PascalCase | `User.ts`, `Activity.ts` |
| Constants | UPPER_SNAKE_CASE | `CATEGORIES.ts`, `CONFIG.ts` |
| Pages | kebab-case (auto) | `[id]/page.tsx` |

## Folder Organization

```
apps/web/src/
â”œâ”€â”€ app/                    # Next.js App Router (Pages)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                # shadcn/ui + Base Components
â”‚   â”œâ”€â”€ layout/            # Layout Components
â”‚   â””â”€â”€ features/          # Feature-spezifische Komponenten
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ utils.ts           # App-spezifische Utilities
â”œâ”€â”€ i18n.ts                # i18n Konfiguration
â””â”€â”€ globals.css            # Global Tailwind Styles

apps/mobile/
â”œâ”€â”€ app/                    # Expo Router (Screens)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                # Base Components
â”‚   â””â”€â”€ features/          # Feature-spezifische Komponenten
â””â”€â”€ tailwind.config.js     # NativeWind Konfiguration

packages/shared/src/
â”œâ”€â”€ types.ts               # All Types & Interfaces
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ format.ts          # Formatting Functions
â”‚   â”œâ”€â”€ validate.ts        # Validation
â”‚   â”œâ”€â”€ math.ts            # Math Utilities
â”‚   â””â”€â”€ date.ts            # Date Utilities
â”œâ”€â”€ queries/               # Supabase Queries
â”‚   â”œâ”€â”€ activities.ts
â”‚   â”œâ”€â”€ events.ts
â”‚   â””â”€â”€ users.ts
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ de.json
â”‚   â”œâ”€â”€ en.json
â”‚   â””â”€â”€ es.json
â””â”€â”€ constants.ts           # Constants & Enums
```

---

# ğŸ› SEKTION 7: HÃ„UFIGE FEHLER & LÃ–SUNGEN

## âŒ Fehler 1: UI Code in @repo/shared

```typescript
// âŒ FALSCH
// packages/shared/src/components/Button.tsx
export function Button() { 
  return <button>...</button>; // âŒ Web-spezifisch!
}

// âœ… RICHTIG
// apps/web/src/components/Button.tsx
// apps/mobile/components/Button.tsx (separate!)
```

**LÃ¶sung:** Separate Components pro App!

---

## âŒ Fehler 2: Platform APIs ohne Abstraktion

```typescript
// âŒ FALSCH
// packages/shared/src/utils/screen.ts
export function getHeight() { 
  return window.innerHeight; // âŒ window existiert nur im Browser!
}

// âœ… RICHTIG - Abstraktion
export interface ScreenProvider {
  getHeight(): number;
}

// Web: apps/web/lib/screenProvider.ts
export class WebScreenProvider implements ScreenProvider {
  getHeight() { return window.innerHeight; }
}

// Mobile: apps/mobile/lib/screenProvider.ts
export class MobileScreenProvider implements ScreenProvider {
  getHeight() { return Dimensions.get('window').height; }
}
```

**LÃ¶sung:** Abstraktion + App-spezifische Implementierungen!

---

## âŒ Fehler 3: Incomplette i18n

```typescript
// âŒ FALSCH - Nur in de.json!
{
  "activity.title": "AktivitÃ¤t"
  // âŒ Nicht in en.json und es.json!
}

// âœ… RICHTIG - ALLE 3 Dateien!
// de.json
{ "activity.title": "AktivitÃ¤t" }
// en.json
{ "activity.title": "Activity" }
// es.json
{ "activity.title": "Actividad" }
```

**LÃ¶sung:** IMMER in **ALLE 3 JSON-Dateien** hinzufÃ¼gen!

---

## âŒ Fehler 4: Any Types verwenden

```typescript
// âŒ FALSCH - any Type
function processData(data: any) {
  return data.something;
}

// âœ… RICHTIG - Proper Types
interface DataType {
  something: string;
}

function processData(data: DataType): string {
  return data.something;
}
```

**LÃ¶sung:** Immer TypeScript Strict Mode nutzen!

---

## âŒ Fehler 5: Tailwind/NativeWind gemischt

```typescript
// âŒ FALSCH - Tailwind in shared (Web only!)
// packages/shared/src/components/Card.tsx
export function Card() {
  return <div className="p-4 rounded-lg">...</div>;
}

// âœ… RICHTIG - Separate Komponenten
// apps/web/src/components/Card.tsx
export function Card() {
  return <div className="bg-white p-4 rounded-lg shadow-md">...</div>;
}

// apps/mobile/components/Card.tsx
export function Card() {
  return <View className="bg-white p-4 rounded-lg">...</View>;
}
```

**LÃ¶sung:** UI-Komponenten mÃ¼ssen pro Platform sein!

---

## âŒ Fehler 6: Inline Styles statt Tailwind

```typescript
// âŒ FALSCH - Inline Styles
<div style={{ padding: '16px', borderRadius: '8px' }}>...</div>

// âœ… RICHTIG - Tailwind Classes
<div className="p-4 rounded-lg">...</div>
```

**LÃ¶sung:** IMMER Tailwind/NativeWind nutzen, keine Inline Styles!

---

## âŒ Fehler 7: console.log in Production

```typescript
// âŒ FALSCH
console.log('Debug:', data); // Bleibt sichtbar!

// âœ… RICHTIG - Proper Logging (z.B. Sentry)
import { captureException } from '@sentry/react';
captureException(new Error('Debug info'), {extra: {data}});
```

**LÃ¶sung:** Proper Logging-Systeme nutzen!

---

## âŒ Fehler 8: Hardcoded Strings

```typescript
// âŒ FALSCH - Hardcoded
return <h1>AktivitÃ¤ten</h1>;  // âŒ Nur in Deutsch!

// âœ… RICHTIG - i18n
const t = useTranslations();
return <h1>{t('activities.title')}</h1>;  // âœ… Alle Sprachen!
```

**LÃ¶sung:** IMMER i18n nutzen!

---

## âŒ Fehler 9: Magic Numbers

```typescript
// âŒ FALSCH
if (age > 18 && price < 99.99) { ... }

// âœ… RICHTIG
const MIN_ADULT_AGE = 18;
const MAX_PRICE = 99.99;

if (age > MIN_ADULT_AGE && price < MAX_PRICE) { ... }
```

**LÃ¶sung:** Constants fÃ¼r Magic Numbers!

---

## âŒ Fehler 10: `git push` selbst machen

```bash
# âŒ NIEMALS!
git push origin main  # â† Claude darf das NICHT!

# âœ… RICHTIG
# Claude: "Code ist fertig, commits sind ready!"
# Matthias: "git push origin main"
# GitHub Actions: Auto-Deploy! âœ…
```

**LÃ¶sung:** NUR der User pusht! GitHub Actions deployt automatisch!

---

# âœ… SEKTION 8: CHECKLISTE VOR JEDEM COMMIT

- [ ] **Shared Package Regeln beachtet?**
  - [ ] UI Code NICHT in @repo/shared
  - [ ] Types in types.ts
  - [ ] Logik in utils/
  - [ ] Queries in queries/
  
- [ ] **i18n vollstÃ¤ndig?**
  - [ ] Keys in de.json
  - [ ] Keys in en.json
  - [ ] Keys in es.json
  - [ ] Format: `{ "section.key": "value" }`

- [ ] **TypeScript sauber?**
  - [ ] Keine `any` Types
  - [ ] Alle Props typed
  - [ ] Alle Returns typed
  - [ ] `bun run type-check` âœ…

- [ ] **Linting OK?**
  - [ ] `bun run lint` âœ…
  - [ ] Keine Warnings

- [ ] **Build erfolgreich?**
  - [ ] `bun run build` âœ…
  - [ ] Beide Apps (web + mobile)

- [ ] **Commits sauber?**
  - [ ] Conventional Commits Format
  - [ ] AussagekrÃ¤ftige Nachrichten
  - [ ] Logische Commits (nicht alles in einen)

- [ ] **Keine Secrets?**
  - [ ] Keine `.env.local` committed
  - [ ] Keine Passwords im Code
  - [ ] Keine API Keys visible

- [ ] **NIEMALS pushen!**
  - [ ] âš ï¸ Nur Claude: git add + git commit
  - [ ] âš ï¸ Nur Matthias: git push origin main

---

# ğŸ“š SEKTION 9: WEITERE RESSOURCEN & LINKS

## ğŸ“– Dokumentationsdateien (Detaillierte Infos)

| Datei | Inhalt | Wenn du... |
|-------|--------|-----------|
| **README.md** | Projekt Ãœberblick | Neu anfangen |
| **QUICKSTART.md** | Schnelleinstieg (5 Min) | Schnell loslegen willst |
| **MONOREPO_GUIDE.md** | Detaillierte Monorepo Regeln | Wissen willst, wo Code hin gehÃ¶rt |
| **ARCHITECTURE.md** | Deep Dive aller Technologien | Das System verstehen willst |
| **DEVELOPMENT_PRINCIPLES.md** | Entwicklungs-Philosophie | Verstehen willst, WARUM wir so bauen |
| **DEPLOYMENT.md** | Deployment Details | Deployen musst |
| **supabase/README.md** | Datenbank Schema | Mit der DB arbeiten musst |

**Siehe auch:**
- `.github/workflows/deploy-staging.yml` - GitHub Actions Config
- `deploy/STAGING_AUTH.md` - Staging Environment Auth
- `deploy/SSH_SETUP.md` - SSH fÃ¼r NotfÃ¤lle

---

# ğŸ¯ SEKTION 10: QUICK REFERENCE (TL;DR)

## Die 5 Goldenen Regeln

1. âœ… **Shared Logik teilen** - Types, Queries, i18n, Logik
2. âœ… **App-spezifische UI trennen** - Komponenten, Pages, Routing
3. âœ… **Alle 3 Sprachen!** - DE/EN/ES in i18n
4. âœ… **TypeScript Strict** - Keine `any` Types
5. âœ… **NUR Matthias pusht** - Claude committet, User deployt

## Schnelle Checkliste

```bash
# Vor jedem Commit
bun run type-check     # âœ… TypeScript OK?
bun run lint           # âœ… Linting OK?
bun run build          # âœ… Beide Apps bauen?

# Commit & fertig
git add .
git commit -m "feat(web): add feature"
# "Code fertig & getestet!"

# NUR MATTHIAS:
git push origin main   # GitHub Actions deployt automatisch!
```

## Bei Unsicherheit

1. Lese `.cursorrules` (diese Datei!) - **DU BIST HIER** ğŸ“–
2. Lese `MONOREPO_GUIDE.md` - Entscheidungsbaum fÃ¼r Code-Placement
3. Lese `ARCHITECTURE.md` - Deep Dive wenn Fragen bleiben
4. Frage nach / Slack / Discuss - Wenn still unklar

---

## ğŸ”´ ABSOLUTES NEVER-EVER (Kritische Do-Nots)

âŒ **NIEMALS:**
- UI Components in @repo/shared
- Inline Styles (nur Tailwind!)
- Platform APIs ohne Abstraktion
- `any` Types
- Incomplete i18n (nur 1-2 Sprachen)
- Secrets/Keys im Code
- git push selbst machen (nur User!)
- Pfusch-LÃ¶sungen fÃ¼r Geschwindigkeit
- copy-paste Code (DRY Principle!)
- console.log im Production Code

âœ… **IMMER:**
- Logik in @repo/shared
- Types fÃ¼r alles
- UI in apps/web oder apps/mobile
- Tailwind/NativeWind fÃ¼r Styling
- i18n fÃ¼r Text (DE/EN/ES!)
- TypeScript Strict Mode
- Code Reviews vor Merge
- Tests schreiben & durchfÃ¼hren
- Dokumentation updaten
- Langfristig denken

---

**Letzte Aktualisierung:** 18. Oktober 2025  
**Status:** âœ… AKTUELL & BINDEND fÃ¼r alle Contributors  
**GÃ¼ltig fÃ¼r:** Alle BefehlsausfÃ¼hrungen der KI auf diesem Projekt
