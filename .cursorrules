# Cursor AI Rules fÃ¼r Mallorca Map Monorepo

## ğŸ¯ Projekt-Kontext

**Name:** Mallorca Map Next  
**Typ:** Full-Stack Monorepo mit Web + Mobile  
**Package Manager:** Bun 1.1.40+  
**Node Version:** >=20.0.0  
**Build Tool:** Turborepo 2.3.3+

---

## ğŸ“ Monorepo-Struktur

```
mallorca-map-next/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                    # ğŸŒ Next.js 15 Web App (SSR/ISR)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/            # App Router mit [lang] Dynamic Routing
â”‚   â”‚   â”‚   â”œâ”€â”€ components/     # React Components (shadcn/ui)
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/            # Utilities (utils.ts)
â”‚   â”‚   â”‚   â”œâ”€â”€ i18n.ts         # Internationalisierung
â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css     # Global Tailwind Styles
â”‚   â”‚   â”‚   â””â”€â”€ public/         # Static Assets + robots.txt
â”‚   â”‚   â”œâ”€â”€ next.config.mjs     # Next.js Config
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts  # Tailwind Setup mit shadcn/ui
â”‚   â”‚   â”œâ”€â”€ postcss.config.js   # PostCSS Config
â”‚   â”‚   â”œâ”€â”€ tsconfig.json       # TS Config
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ mobile/                 # ğŸ“± React Native Expo App
â”‚       â”œâ”€â”€ app/                # Expo Router (Native Stack)
â”‚       â”œâ”€â”€ components/         # Native Components
â”‚       â”œâ”€â”€ assets/             # Images, Fonts
â”‚       â”œâ”€â”€ tailwind.config.js  # NativeWind Config
â”‚       â”œâ”€â”€ babel.config.js     # Metro Bundler Config
â”‚       â”œâ”€â”€ app.json            # Expo Config
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/                 # ğŸ“¦ Shared Utilities
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ i18n/           # Translations (de.json, en.json, es.json)
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/          # date.ts, string.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ supabase/               # ğŸ—„ï¸ Supabase Client + Types
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts       # Supabase Client Init
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts        # Generated Types
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ typescript-config/      # âš™ï¸ Shared TS Configs
â”‚       â”œâ”€â”€ base.json           # Base Config
â”‚       â”œâ”€â”€ nextjs.json         # Next.js Config
â”‚       â”œâ”€â”€ react-native.json   # React Native Config
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ deploy/                     # ğŸš€ Deployment Scripts
â”‚   â”œâ”€â”€ nginx-staging.conf      # Nginx Config mit Auth
â”‚   â”œâ”€â”€ setup-staging-auth.sh   # Passwort-Setup Script
â”‚   â””â”€â”€ STAGING_AUTH.md         # Auth Dokumentation
â”‚
â”œâ”€â”€ turbo.json                  # Turborepo Pipeline
â”œâ”€â”€ package.json                # Root Workspace
â”œâ”€â”€ bun.lock                    # Bun Lockfile
â””â”€â”€ .cursorrules                # Diese Datei!
```

---

## ğŸ”§ Tech Stack Ãœbersicht

### Frontend - Web
- **Next.js 15** - React Framework mit SSR/ISR
- **TypeScript** - Type Safety
- **Tailwind CSS 3.4** - Utility-First Styling
- **shadcn/ui** - Accessible UI Components
- **next-intl 3.26** - Mehrsprachigkeit (DE/EN/ES)
- **lucide-react** - Icons

### Frontend - Mobile
- **React Native** - Cross-Platform Mobile
- **Expo** - RN Development Platform
- **Expo Router** - Native Navigation
- **NativeWind** - Tailwind fÃ¼r React Native
- **TypeScript** - Type Safety

### Backend
- **Supabase** - PostgreSQL + Auth + Realtime
- **API:** RESTful Ã¼ber Supabase
- **Database:** PostgreSQL
- **Auth:** Supabase Auth

### DevOps/Build
- **Turborepo** - Monorepo Task Orchestration
- **Bun** - Fast Package Manager + Runtime
- **Nginx** - Reverse Proxy + SSL
- **PM2/Systemd** - Process Management

### Styling System
- **Base Colors:**
  - Primary: `#14B8C4` (Teal)
  - Secondary: `#F4EDE4` (Beige)
  - Accent: `#FF6B6B` (Red)

---

## ğŸš€ Wichtige Commands

### Root Commands (Turborepo)
```bash
bun install              # Dependencies installieren
bun run dev              # Alle Apps parallel starten (watch mode)
bun run build            # Production Build aller Apps
bun run lint             # ESLint Check
bun run type-check       # TypeScript Check
bun run clean            # Clean Build Artifacts
```

### Web App Specific
```bash
cd apps/web
bun run dev              # Next.js auf Port 3000
bun run build            # Production Build
bun run start            # Standalone Mode
```

### Mobile App Specific
```bash
cd apps/mobile
bun run dev              # Expo Dev Server
bun run build            # EAS Build
```

### Packages
```bash
cd packages/shared
bun run build            # Build shared package
```

---

## ğŸ“‹ Internationalisierung (i18n)

### Sprachen
- **DE** (Deutsch) - `de.json`
- **EN** (English) - `en.json`  
- **ES** (EspaÃ±ol) - `es.json`

### Routing
Die App nutzt **Dynamic Segment** `[lang]`:
```
/de â†’ Deutsch
/en â†’ English
/es â†’ EspaÃ±ol
```

### Komponenten-Verwendung
```typescript
import { useTranslations } from 'next-intl';

export default function MyComponent() {
  const t = useTranslations();
  return <h1>{t('home.title')}</h1>;
}
```

### Neue Ãœbersetzungen hinzufÃ¼gen
1. Edit `packages/shared/src/i18n/de.json` (und en.json, es.json)
2. Format: `{ "section.key": "Wert" }`
3. Commit + Deploy

---

## ğŸ¨ Styling Guidelines

### Tailwind Klassen
- **Responsive:** `md:`, `lg:`, `xl:` Prefixes
- **Dark Mode:** Bereits konfiguriert mit `darkMode: ['class']`
- **Custom Colors:** Definiert in `tailwind.config.ts`

### shadcn/ui Components
- Importieren von `@/components/ui/`
- Beispiel: `Button`, `Input`, `Card`, `Dialog`
- VollstÃ¤ndig typsicher mit TypeScript

### CSS Modules vs Tailwind
- **Bevorzugt:** Tailwind CSS Classes
- **Fallback:** CSS Modules wenn nÃ¶tig (`.module.css`)
- **Global Styles:** `src/globals.css`

---

## ğŸ” Authentifizierung & Datenbank

### Supabase Client
```typescript
import { supabase } from '@repo/supabase';

// Beispiel
const { data, error } = await supabase
  .from('table_name')
  .select('*')
  .eq('id', 1);
```

### Environment Variables
**apps/web/.env.local:**
```env
NEXT_PUBLIC_SUPABASE_URL=https://ayetwgaainiskwqvgubd.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key_here
```

**apps/mobile/.env.local:**
```env
EXPO_PUBLIC_SUPABASE_URL=https://ayetwgaainiskwqvgubd.supabase.co
EXPO_PUBLIC_SUPABASE_ANON_KEY=your_key_here
```

---

## ğŸ“¦ Shared Packages

### @repo/shared
- **i18n:** Ãœbersetzungsdateien
- **utils/date.ts:** Datum-Helpers
- **utils/string.ts:** String-Utilities

Import: `import { someUtil } from '@repo/shared';`

### @repo/supabase
- **client.ts:** Initialisierter Supabase Client
- **types.ts:** Auto-Generated Types von DB

Import: `import { supabase } from '@repo/supabase';`

### @repo/typescript-config
- **base.json:** Basis TS Config
- **nextjs.json:** FÃ¼r Web App
- **react-native.json:** FÃ¼r Mobile App

---

## ğŸš€ Staging Deployment

### Passwortschutz
- **URL:** `https://staging.mallorca-map.com`
- **Username:** `staging`
- **Password:** `9963`
- **Setup:** Siehe `deploy/STAGING_AUTH.md`

### 3-Layer Security
1. **HTTP Basic Auth** (Nginx) - Blockiert 100% ohne Passwort
2. **HTTP Headers** (X-Robots-Tag, Cache-Control)
3. **robots.txt** - Blockiert Bots und Crawler

### Deploy zur Staging
```bash
# 1. Code changes committen
git add .
git commit -m "message"
git push origin main

# 2. SSH zum Server
ssh user@staging.mallorca-map.com

# 3. Pull + Deploy
cd /home/app/mallorca-map-next
git pull origin main
bun install && bun run build
sudo systemctl restart mallorca-map-staging

# 4. Nginx testen
sudo nginx -t && sudo systemctl reload nginx
```

---

## âœ… Code Konventionen

### TypeScript
- **Strict Mode:** Aktiviert in `tsconfig.json`
- **Typ-Annotationen:** Immer fÃ¼r Props und Returns
- **Imports:** Alias `@/` verwenden statt `../../../`

### Component Structure
```typescript
// Imports
import { ReactNode } from 'react';
import { Button } from '@/components/ui/button';

// Types
interface MyComponentProps {
  title: string;
  children?: ReactNode;
}

// Component
export function MyComponent({ title, children }: MyComponentProps) {
  return (
    <div>
      <Button>{title}</Button>
      {children}
    </div>
  );
}
```

### File Naming
- **Components:** PascalCase (`Button.tsx`, `Card.tsx`)
- **Utilities:** camelCase (`dateUtils.ts`, `stringHelpers.ts`)
- **Types:** PascalCase (`User.ts`, `Product.ts`)

### Folder Organization
- Components grouped by feature/area
- Related utils in same folder
- Tests co-located with source files

---

## ğŸ› HÃ¤ufige Probleme & LÃ¶sungen

### Turborepo Build Fehler
```bash
# Clear cache
bun run clean

# Rebuild
bun run build
```

### Type Errors nach Ã„nderungen
```bash
bun run type-check
```

### Module not found
- Check imports are using `@/` alias
- Ensure package.json has correct workspace reference
- Run `bun install` in root

### Styling nicht angewendet
- Tailwind content paths in `tailwind.config.ts`
- Check CSS ist in `globals.css` importiert
- Clear `.next` folder: `rm -rf apps/web/.next`

---

## ğŸ¯ Cursor AI Richtlinien

### Wenn du Code debuggen sollst:
1. **Lese zuerst** die relevante Datei komplett
2. **Verstehe** die Komponenten-Hierarchie
3. **Check** den Datenfluss (Props â†’ State â†’ Output)
4. **Teste** deine LÃ¶sung mit den Commands oben

### Wenn du neue Features bauen sollst:
1. **Ask:** Sollte es in `apps/web` oder `apps/mobile`?
2. **Check:** Kann Code in `packages/shared` wiederverwendet werden?
3. **TypeScript:** Immer Typen definieren
4. **Test:** Mit `bun run type-check && bun run lint`

### Wenn du Komponenten erstellst:
1. **Use:** shadcn/ui Components als Base
2. **Style:** Mit Tailwind CSS
3. **Accept Props:** Immer typisiert
4. **Export:** Named Export, nicht default

### Wenn du i18n Strings editierst:
1. **Update:** Alle 3 JSON-Dateien (de/en/es)
2. **Format:** Immer `"section.key": "value"`
3. **Test:** Mit allen 3 Sprachen testen
4. **Commit:** Mit aussagekrÃ¤ftigem Message

### Wenn du Deployment-Issues hast:
1. **Check:** SSH zum Server mÃ¶glich?
2. **Logs:** `sudo journalctl -u mallorca-map-staging -f`
3. **Nginx:** `sudo nginx -t` vor reload
4. **Bun:** `bun install && bun run build` in App-Folder

---

## ğŸ“š ZusÃ¤tzliche Ressourcen

- **Next.js Docs:** https://nextjs.org/docs
- **Tailwind Docs:** https://tailwindcss.com/docs
- **shadcn/ui:** https://ui.shadcn.com/
- **Turborepo:** https://turbo.build/
- **Expo Docs:** https://docs.expo.dev/
- **Supabase:** https://supabase.com/docs

---

## ğŸ“ Zusammenfassung fÃ¼r Claude/ChatGPT

Wenn ich dir Code zum editieren gebe:
1. âœ… Respektiere die Folder-Struktur
2. âœ… Verwende TypeScript Typen
3. âœ… Nutze Tailwind CSS fÃ¼r Styling
4. âœ… Check Turborepo Dependencies
5. âœ… Teste mit `bun run build` vor dem Commit
6. âœ… Update diese `.cursorrules` wenn die Struktur sich Ã¤ndert

Wenn ich frage "Wie funktioniert X?":
1. ğŸ“– Zeige mir die relevanten Files
2. ğŸ” ErklÃ¤re den Datenfluss
3. ğŸ“ Code-Snippets mit Kontext
4. ğŸ§ª Wie man es testet

Wenn ich sage "Mache einen Deploy":
1. ğŸ”§ ErklÃ¤re alle Schritte
2. ğŸ” Frage nach SSH-ZugÃ¤ngen wenn nÃ¶tig
3. ğŸ“‹ Gib mir ein Checkliste
4. âœ¨ Teste vor Produktiv-Deploy
